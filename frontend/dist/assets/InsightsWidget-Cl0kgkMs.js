import{c as J,j as e,B as c,a as j,U as $,X as K,D as q,C as Q}from"./index-gm4XY7Dh.js";import{r as n}from"./vendor-CvUQ7FSA.js";import{A as M,b as B,a as O}from"./alert-dbwOQxjT.js";import{C as i,a as l,b as H,c as W}from"./Card-ct0JxCCf.js";import{m as X,a as G,T as F}from"./mlService-CJ6D2i2K.js";import{T as E}from"./triangle-alert-CMRBmGwV.js";import{I as D}from"./info-b7pG8t1m.js";import{C as Y}from"./clock-Tx-U9-MC.js";import{E as Z}from"./eye-2sExp-ov.js";import{C as P}from"./circle-alert-B-efKsjX.js";import{P as ee}from"./progress-BSuwBYA5.js";import{B as U}from"./brain-DppQ7xr_.js";import{S as se,L as V}from"./RecommendationPanel-BRi5PorH.js";import{A as te}from"./arrow-right-BwqWpyzD.js";import{T as _}from"./trending-up-CbsLnhxQ.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"M5 12h14",key:"1ays0h"}]],k=J("minus",re),pe=({timeframe:f,type:N="attendance",threshold:g=.7,autoRefresh:y=!1,refreshInterval:S=15,onAnomalyClick:x,compact:d=!1})=>{const[p,r]=n.useState([]),[T,o]=n.useState(!0),[A,h]=n.useState(null),[R,L]=n.useState(new Set);n.useEffect(()=>{if(u(),y){const s=setInterval(u,S*60*1e3);return()=>clearInterval(s)}},[f,N,g,y,S]);const u=async()=>{try{o(!0),h(null);const s=f||{start:new Date(Date.now()-24*60*60*1e3).toISOString(),end:new Date().toISOString()},b=await X.detectAnomalies({type:N,timeframe:s,threshold:g,includeRecommendations:!0});b.success&&b.data?r(b.data.anomalies):h("Impossible de charger les anomalies")}catch(s){h(s.message||"Erreur lors du chargement"),console.error("Error loading anomalies:",s)}finally{o(!1)}},C=s=>{switch(s){case"high":return e.jsx(E,{className:"w-4 h-4 text-red-500"});case"medium":return e.jsx(P,{className:"w-4 h-4 text-yellow-500"});case"low":return e.jsx(D,{className:"w-4 h-4 text-blue-500"});default:return e.jsx(D,{className:"w-4 h-4 text-gray-500"})}},w=s=>{switch(s){case"high":return"border-red-500 bg-red-50";case"medium":return"border-yellow-500 bg-yellow-50";case"low":return"border-blue-500 bg-blue-50";default:return"border-gray-500 bg-gray-50"}},v=s=>s.includes("attendance")?e.jsx($,{className:"w-4 h-4"}):s.includes("event")?e.jsx(q,{className:"w-4 h-4"}):s.includes("behavior")?e.jsx(G,{className:"w-4 h-4"}):e.jsx(P,{className:"w-4 h-4"}),I=s=>{L(b=>new Set([...b,s]))},z=s=>{x==null||x(s)},a=p.filter(s=>!R.has(s.id)),m=a.filter(s=>s.severity==="high").length,t=a.filter(s=>s.severity==="medium").length;return T?e.jsx(i,{className:d?"h-20":"h-32",children:e.jsx(l,{className:"p-4 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"})})}):A?e.jsxs(M,{variant:"destructive",children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx(B,{children:"Erreur de détection"}),e.jsx(O,{children:A})]}):a.length===0?d?e.jsx(i,{className:"h-20",children:e.jsx(l,{className:"p-4 flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center text-green-600",children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"text-sm",children:"Aucune anomalie détectée"})]})})}):e.jsxs(M,{children:[e.jsx(D,{className:"h-4 w-4"}),e.jsx(B,{children:"Système normal"}),e.jsx(O,{children:"Aucune anomalie détectée dans les dernières 24 heures."})]}):d?e.jsx(i,{className:"h-20",children:e.jsx(l,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(E,{className:"w-4 h-4 text-red-500"}),e.jsxs("span",{className:"text-sm font-medium",children:[a.length," anomalie",a.length>1?"s":""]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[m>0&&e.jsxs(c,{variant:"destructive",className:"text-xs",children:[m," critique",m>1?"s":""]}),t>0&&e.jsxs(c,{variant:"secondary",className:"text-xs",children:[t," modérée",t>1?"s":""]})]})]})})}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs(i,{children:[e.jsx(H,{className:"pb-3",children:e.jsxs(W,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(E,{className:"w-5 h-5 text-red-500"}),e.jsx("span",{children:"Anomalies Détectées"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(c,{variant:"outline",className:"text-xs",children:[a.length," total"]}),e.jsx(j,{variant:"outline",size:"sm",onClick:u,children:"Actualiser"})]})]})}),e.jsx(l,{children:e.jsxs("div",{className:"flex items-center space-x-4 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full"}),e.jsxs("span",{children:[m," critique",m>1?"s":""]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded-full"}),e.jsxs("span",{children:[t," modérée",t>1?"s":""]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full"}),e.jsxs("span",{children:[a.filter(s=>s.severity==="low").length," mineure",a.filter(s=>s.severity==="low").length>1?"s":""]})]})]})})]}),e.jsx("div",{className:"space-y-2",children:a.slice(0,5).map(s=>e.jsx(M,{className:w(s.severity),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[C(s.severity),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[v(s.type),e.jsx(B,{className:"text-sm",children:s.description})]}),e.jsxs(O,{className:"text-xs",children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-2",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(Y,{className:"w-3 h-3 mr-1"}),new Date(s.detectedAt).toLocaleString("fr-FR")]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx($,{className:"w-3 h-3 mr-1"}),s.affectedEntities.length," entité",s.affectedEntities.length>1?"s":""," affectée",s.affectedEntities.length>1?"s":""]}),e.jsxs(c,{variant:"outline",className:"text-xs",children:[Math.round(s.confidence*100),"% confiance"]})]}),s.recommendations&&s.recommendations.length>0&&e.jsxs("div",{className:"mt-2 p-2 bg-white/50 rounded text-xs",children:[e.jsx("strong",{children:"Recommandation:"})," ",s.recommendations[0]]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>z(s),className:"h-6 w-6 p-0",children:e.jsx(Z,{className:"w-3 h-3"})}),e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>I(s.id),className:"h-6 w-6 p-0",children:e.jsx(K,{className:"w-3 h-3"})})]})]})},s.id))}),a.length>5&&e.jsx("div",{className:"text-center",children:e.jsxs(j,{variant:"outline",size:"sm",children:["Voir ",a.length-5," anomalie",a.length-5>1?"s":""," de plus"]})})]})},we=({type:f,targetId:N,timeframe:g,maxInsights:y=3,showTrends:S=!0,showRecommendations:x=!0,compact:d=!1,onInsightClick:p})=>{const[r,T]=n.useState([]),[o,A]=n.useState([]),[h,R]=n.useState([]),[L,u]=n.useState(!0),[C,w]=n.useState(null);n.useEffect(()=>{v()},[f,N,g]);const v=async()=>{try{u(!0),w(null);const t=g||{start:new Date(Date.now()-30*24*60*60*1e3).toISOString(),end:new Date().toISOString()},s=await X.generateInsights({type:f,targetId:N,timeframe:t,includeRecommendations:x});s.success&&s.data?(T(s.data.insights.slice(0,y)),A(s.data.trends),R(s.data.recommendations)):w("Impossible de charger les insights")}catch(t){w(t.message||"Erreur lors du chargement"),console.error("Error loading insights:",t)}finally{u(!1)}},I=t=>{switch(t){case"user_preference":return e.jsx($,{className:"w-4 h-4"});case"scheduling":return e.jsx(q,{className:"w-4 h-4"});case"performance":return e.jsx(Q,{className:"w-4 h-4"});case"trend":return e.jsx(_,{className:"w-4 h-4"});case"seasonal":return e.jsx(q,{className:"w-4 h-4"});default:return e.jsx(V,{className:"w-4 h-4"})}},z=t=>{switch(t){case"up":return e.jsx(_,{className:"w-4 h-4 text-green-600"});case"down":return e.jsx(G,{className:"w-4 h-4 text-red-600"});case"stable":return e.jsx(k,{className:"w-4 h-4 text-gray-600"});default:return e.jsx(k,{className:"w-4 h-4 text-gray-600"})}},a=t=>{switch(t){case"high":return"text-red-600 bg-red-50";case"medium":return"text-yellow-600 bg-yellow-50";case"low":return"text-blue-600 bg-blue-50";default:return"text-gray-600 bg-gray-50"}},m=t=>t>=.8?"text-green-600":t>=.6?"text-yellow-600":"text-red-600";return L?e.jsx(i,{className:d?"h-32":"h-48",children:e.jsx(l,{className:"p-6 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):C?e.jsx(i,{className:d?"h-32":"h-48",children:e.jsxs(l,{className:"p-6 flex flex-col items-center justify-center",children:[e.jsx(U,{className:"w-8 h-8 text-red-500 mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground text-center",children:C}),e.jsx(j,{variant:"outline",size:"sm",onClick:v,className:"mt-2",children:"Réessayer"})]})}):r.length===0&&o.length===0?e.jsx(i,{className:d?"h-32":"h-48",children:e.jsxs(l,{className:"p-6 flex flex-col items-center justify-center",children:[e.jsx(se,{className:"w-8 h-8 text-muted-foreground mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"Aucun insight disponible pour cette période"})]})}):d?e.jsx(i,{className:"h-32",children:e.jsxs(l,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-sm font-medium",children:"Insights IA"})]}),e.jsxs(c,{variant:"outline",className:"text-xs",children:[r.length," insight",r.length>1?"s":""]})]}),r.length>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[I(r[0].category),e.jsx("span",{className:"text-xs text-muted-foreground truncate",children:r[0].title})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ee,{value:r[0].confidence*100,className:"h-1 flex-1 mr-2"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[Math.round(r[0].confidence*100),"%"]})]})]})]})}):e.jsxs(i,{children:[e.jsx(H,{className:"pb-3",children:e.jsxs(W,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{className:"w-5 h-5 text-primary"}),e.jsx("span",{children:"Insights IA"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(c,{variant:"outline",className:"text-xs",children:[r.length," insight",r.length>1?"s":""]}),e.jsx(j,{variant:"outline",size:"sm",onClick:v,children:"Actualiser"})]})]})}),e.jsxs(l,{className:"space-y-4",children:[r.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"text-sm font-medium flex items-center",children:[e.jsx(V,{className:"w-4 h-4 mr-1"}),"Insights Clés"]}),r.map((t,s)=>e.jsxs("div",{className:"p-3 border rounded-lg hover:bg-muted/50 cursor-pointer transition-colors",onClick:()=>p==null?void 0:p(t),children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[I(t.category),e.jsx("span",{className:"font-medium text-sm",children:t.title})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(c,{variant:"outline",className:`text-xs ${m(t.confidence)}`,children:[Math.round(t.confidence*100),"%"]}),t.actionable&&e.jsx(c,{variant:"secondary",className:"text-xs",children:"Actionnable"})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:t.description}),t.action&&e.jsxs("div",{className:"flex items-center text-xs text-primary",children:[e.jsx(F,{className:"w-3 h-3 mr-1"}),e.jsx("span",{children:t.action.description}),e.jsx(te,{className:"w-3 h-3 ml-1"})]})]},s))]}),S&&o.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"text-sm font-medium flex items-center",children:[e.jsx(_,{className:"w-4 h-4 mr-1"}),"Tendances"]}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:o.slice(0,3).map((t,s)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-muted rounded",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[z(t.direction),e.jsx("span",{className:"text-sm",children:t.metric})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:`text-sm font-medium ${t.direction==="up"?"text-green-600":t.direction==="down"?"text-red-600":"text-gray-600"}`,children:[t.direction==="up"?"+":t.direction==="down"?"-":"",Math.abs(t.change),"%"]}),e.jsx(c,{variant:"outline",className:`text-xs ${a(t.significance)}`,children:t.significance})]})]},s))})]}),x&&h.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"text-sm font-medium flex items-center",children:[e.jsx(F,{className:"w-4 h-4 mr-1"}),"Recommandations"]}),e.jsx("div",{className:"space-y-2",children:h.slice(0,2).map((t,s)=>e.jsx("div",{className:"text-sm text-muted-foreground bg-blue-50 p-3 rounded border-l-4 border-blue-500",children:t},s))})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Dernière mise à jour: ",new Date().toLocaleTimeString("fr-FR")]}),e.jsx("span",{children:"IA v2.0"})]})]})]})};export{pe as A,we as I};
//# sourceMappingURL=InsightsWidget-Cl0kgkMs.js.map
