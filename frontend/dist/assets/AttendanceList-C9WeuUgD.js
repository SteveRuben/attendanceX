import{w as H,z as J,y as v,j as e,a as m,J as A,o as X,G as K,H as W,I as Y,D as Z,B as S}from"./index-gm4XY7Dh.js";import{d as ee,r as d,L as se}from"./vendor-CvUQ7FSA.js";import{C as n,a as c}from"./Card-ct0JxCCf.js";import{I as D}from"./Input-BoijLIkg.js";import{S as P,a as E,b as I,c as T,d as i}from"./select-byvKiojp.js";import{a as u}from"./attendanceService-BE_yyzd4.js";import{D as ae}from"./download-C1GnnIYf.js";import{C as k}from"./circle-check-big-eEft8Q46.js";import{C as B}from"./circle-x-B_KOwtkV.js";import{T as te}from"./trending-up-CbsLnhxQ.js";import{C as re}from"./clock-Tx-U9-MC.js";import{M as le}from"./map-pin-Dg8dt4LF.js";import{T as M}from"./timer-grUHIzZ1.js";import{C as z}from"./circle-alert-B-efKsjX.js";import"./firebase-De9GV7Vy.js";import"./index-TMJn6bF9.js";import"./chevron-down-L5bpcUyJ.js";import"./check-Cx9i6ejF.js";const Ae=()=>{const{user:ie}=H(),{canViewAttendances:p,canManageAttendances:F}=J();ee();const[j,f]=d.useState([]),[R,N]=d.useState(!0),[x,U]=d.useState({total:0,present:0,absent:0,late:0,attendanceRate:0}),[r,b]=d.useState({search:"",status:"all",method:"all",eventId:"",startDate:"",endDate:""}),[l,o]=d.useState({page:1,limit:20,total:0,totalPages:0});d.useEffect(()=>{$(),V()},[r,l.page]);const $=async()=>{try{N(!0);const s={page:l.page,limit:l.limit,sortBy:"checkInTime",sortOrder:"desc"};r.search&&(s.search=r.search),r.status!=="all"&&(s.status=r.status),r.method!=="all"&&(s.method=r.method),r.eventId&&(s.eventId=r.eventId),r.startDate&&(s.startDate=r.startDate),r.endDate&&(s.endDate=r.endDate);const a=p?await u.getAttendances(s):await u.getMyAttendances(s);a.success&&a.data&&(Array.isArray(a.data)?f(a.data):(f(a.data.data),o(t=>({...t,total:a.data.pagination.total,totalPages:a.data.pagination.totalPages}))))}catch(s){console.error("Error loading attendances:",s),v.error("Erreur lors du chargement des présences")}finally{N(!1)}},V=async()=>{try{const s=await u.getAttendanceStats();s.success&&s.data&&U(s.data)}catch(s){console.error("Error loading stats:",s)}},_=s=>{b(a=>({...a,search:s})),o(a=>({...a,page:1}))},g=(s,a)=>{b(t=>({...t,[s]:a})),o(t=>({...t,page:1}))},q=s=>{const t={present:{variant:"default",label:"Présent",icon:k},absent:{variant:"destructive",label:"Absent",icon:B},late:{variant:"secondary",label:"En retard",icon:M},excused:{variant:"outline",label:"Excusé",icon:z},left_early:{variant:"secondary",label:"Parti tôt",icon:M}}[s]||{variant:"outline",label:s,icon:z},h=t.icon;return e.jsxs(S,{variant:t.variant,className:"flex items-center gap-1",children:[e.jsx(h,{className:"w-3 h-3"}),t.label]})},L=s=>{const t={qr_code:{variant:"default",label:"QR Code"},geolocation:{variant:"secondary",label:"Géolocalisation"},manual:{variant:"outline",label:"Manuel"},biometric:{variant:"default",label:"Biométrique"},nfc:{variant:"secondary",label:"NFC"}}[s]||{variant:"outline",label:s};return e.jsx(S,{variant:t.variant,children:t.label})},G=s=>{var a;if(s!=null&&s.firstName&&(s!=null&&s.lastName))return`${s.firstName[0]}${s.lastName[0]}`.toUpperCase();if(s!=null&&s.displayName){const t=s.displayName.split(" ");return t.length>1?`${t[0][0]}${t[1][0]}`.toUpperCase():t[0][0].toUpperCase()}return((a=s==null?void 0:s.email)==null?void 0:a[0].toUpperCase())||"U"},O=s=>new Date(s).toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),Q=async()=>{try{(await u.exportAttendances(r,"csv")).success&&v.success("Export en cours de téléchargement")}catch{v.error("Erreur lors de l'export")}};return R&&j.length===0?e.jsx("div",{className:"container-fluid py-6",children:e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsx("div",{className:"h-8 bg-muted rounded w-1/3"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[...Array(4)].map((s,a)=>e.jsx("div",{className:"h-24 bg-muted rounded"},a))}),e.jsx("div",{className:"grid gap-4",children:[...Array(5)].map((s,a)=>e.jsx("div",{className:"h-24 bg-muted rounded"},a))})]})}):e.jsxs("div",{className:"container-fluid py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Présences"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Suivez et gérez les présences aux événements"})]}),e.jsx("div",{className:"flex items-center space-x-3",children:p&&e.jsxs(m,{variant:"outline",onClick:Q,children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Exporter"]})})]}),p&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx(n,{className:"metric-card",children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"metric-label",children:"Total présences"}),e.jsx("p",{className:"metric-value",children:x.total})]}),e.jsx(A,{className:"w-8 h-8 text-blue-600"})]})})}),e.jsx(n,{className:"metric-card",children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"metric-label",children:"Présents"}),e.jsx("p",{className:"metric-value",children:x.present})]}),e.jsx(k,{className:"w-8 h-8 text-green-600"})]})})}),e.jsx(n,{className:"metric-card",children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"metric-label",children:"Absents"}),e.jsx("p",{className:"metric-value",children:x.absent})]}),e.jsx(B,{className:"w-8 h-8 text-red-600"})]})})}),e.jsx(n,{className:"metric-card",children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"metric-label",children:"Taux de présence"}),e.jsxs("p",{className:"metric-value",children:[x.attendanceRate.toFixed(1),"%"]})]}),e.jsx(te,{className:"w-8 h-8 text-purple-600"})]})})})]}),e.jsx(n,{children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(X,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(D,{placeholder:"Rechercher...",value:r.search,onChange:s=>_(s.target.value),className:"pl-10"})]}),e.jsxs(P,{value:r.status,onValueChange:s=>g("status",s),children:[e.jsx(E,{children:e.jsx(I,{placeholder:"Statut"})}),e.jsxs(T,{children:[e.jsx(i,{value:"all",children:"Tous les statuts"}),e.jsx(i,{value:"present",children:"Présent"}),e.jsx(i,{value:"absent",children:"Absent"}),e.jsx(i,{value:"late",children:"En retard"}),e.jsx(i,{value:"excused",children:"Excusé"}),e.jsx(i,{value:"left_early",children:"Parti tôt"})]})]}),e.jsxs(P,{value:r.method,onValueChange:s=>g("method",s),children:[e.jsx(E,{children:e.jsx(I,{placeholder:"Méthode"})}),e.jsxs(T,{children:[e.jsx(i,{value:"all",children:"Toutes les méthodes"}),e.jsx(i,{value:"qr_code",children:"QR Code"}),e.jsx(i,{value:"geolocation",children:"Géolocalisation"}),e.jsx(i,{value:"manual",children:"Manuel"}),e.jsx(i,{value:"biometric",children:"Biométrique"}),e.jsx(i,{value:"nfc",children:"NFC"})]})]}),e.jsx(D,{type:"date",placeholder:"Date de début",value:r.startDate,onChange:s=>g("startDate",s.target.value)})]})})}),e.jsx("div",{className:"space-y-4",children:j.length>0?j.map(s=>{var a,t,h,y,C,w;return e.jsx(n,{className:"card-interactive",children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(K,{className:"w-10 h-10",children:[e.jsx(W,{src:(a=s.user)==null?void 0:a.profilePicture}),e.jsx(Y,{children:G(s.user)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-1",children:[e.jsx("h3",{className:"font-semibold text-foreground",children:((t=s.user)==null?void 0:t.displayName)||`${(h=s.user)==null?void 0:h.firstName} ${(y=s.user)==null?void 0:y.lastName}`||((C=s.user)==null?void 0:C.email)}),q(s.status),L(s.method)]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Z,{className:"w-4 h-4 mr-1"}),((w=s.event)==null?void 0:w.title)||"Événement supprimé"]}),s.checkInTime&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(re,{className:"w-4 h-4 mr-1"}),O(s.checkInTime)]}),s.location&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(le,{className:"w-4 h-4 mr-1"}),s.location.name]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[s.event&&e.jsx(m,{variant:"outline",size:"sm",asChild:!0,children:e.jsx(se,{to:`/events/${s.event.id}`,children:"Voir événement"})}),F&&s.validationStatus==="pending"&&e.jsx(m,{variant:"outline",size:"sm",children:"Valider"})]})]})})},s.id)}):e.jsx(n,{children:e.jsxs(c,{className:"p-12 text-center",children:[e.jsx(A,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:"Aucune présence trouvée"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:Object.values(r).some(s=>s&&s!=="all")?"Aucune présence ne correspond à vos critères de recherche.":"Aucune présence n'a encore été enregistrée."})]})})}),l.totalPages>1&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Affichage de ",(l.page-1)*l.limit+1," à"," ",Math.min(l.page*l.limit,l.total)," sur ",l.total," présences"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(m,{variant:"outline",size:"sm",onClick:()=>o(s=>({...s,page:s.page-1})),disabled:l.page===1,children:"Précédent"}),e.jsx(m,{variant:"outline",size:"sm",onClick:()=>o(s=>({...s,page:s.page+1})),disabled:l.page===l.totalPages,children:"Suivant"})]})]})]})};export{Ae as default};
//# sourceMappingURL=AttendanceList-C9WeuUgD.js.map
