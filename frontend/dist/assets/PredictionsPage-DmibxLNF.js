import{y as j,j as e,a as f,D as k,B as V,U as O,o as $}from"./index-gm4XY7Dh.js";import{r as a}from"./vendor-CvUQ7FSA.js";import{C as c,b as z,c as H,a as d}from"./Card-ct0JxCCf.js";import{I as _}from"./Input-BoijLIkg.js";import{S as g,a as v,b as N,c as w,d as n}from"./select-byvKiojp.js";import{A as G}from"./AttendancePredictionCard-B0RI0VTX.js";import{e as J}from"./eventService-DkagHfbT.js";import{m as K,T as Q}from"./mlService-CJ6D2i2K.js";import"./progress-BSuwBYA5.js";import{T as I}from"./trending-up-CbsLnhxQ.js";import{D as W}from"./download-C1GnnIYf.js";import{R as X}from"./refresh-cw-dQTnxzmC.js";import{C as Y}from"./circle-check-big-eEft8Q46.js";import{T as Z}from"./triangle-alert-CMRBmGwV.js";import"./firebase-De9GV7Vy.js";import"./index-TMJn6bF9.js";import"./chevron-down-L5bpcUyJ.js";import"./check-Cx9i6ejF.js";import"./brain-DppQ7xr_.js";import"./info-b7pG8t1m.js";import"./clock-Tx-U9-MC.js";const we=()=>{const[b,L]=a.useState([]),[t,S]=a.useState(null),[i,U]=a.useState([]),[q,C]=a.useState(!1),[m,R]=a.useState(""),[u,y]=a.useState("all"),[x,P]=a.useState("all");a.useEffect(()=>{F()},[]),a.useEffect(()=>{t&&T()},[t]);const F=async()=>{try{const s=await J.getUpcomingEvents(20);s.success&&s.data&&(L(s.data),s.data.length>0&&S(s.data[0]))}catch(s){console.error("Error loading events:",s),j.error("Erreur lors du chargement des événements")}},T=async()=>{if(t)try{C(!0);const s=await K.batchPredictAttendance({eventId:t.id,userIds:t.participants,includeFactors:!0,includeRecommendations:!0});s.success&&s.data?U(s.data):j.error("Erreur lors du chargement des prédictions")}catch(s){console.error("Error loading predictions:",s),j.error("Erreur lors du chargement des prédictions")}finally{C(!1)}},A=i.filter(s=>!(m&&!s.userName.toLowerCase().includes(m.toLowerCase())||u!=="all"&&s.prediction.riskLevel!==u||x!=="all"&&s.prediction.expectedStatus!==x)),D=()=>{if(i.length===0)return null;const s=i.length,l=i.filter(r=>r.prediction.willAttend).length,o=i.filter(r=>r.prediction.riskLevel==="high").length,p=i.reduce((r,E)=>{const M=E.prediction.confidence==="high"?1:E.prediction.confidence==="medium"?.7:.4;return r+M},0)/s;return{totalPredictions:s,willAttend:l,attendanceRate:Math.round(l/s*100),highRisk:o,averageConfidence:Math.round(p*100)}},B=()=>{if(i.length===0){j.warning("Aucune prédiction à exporter");return}const s=[["Utilisateur","Probabilité","Statut Prédit","Niveau de Risque","Confiance"].join(","),...i.map(r=>[r.userName,`${Math.round(r.prediction.probability*100)}%`,r.prediction.expectedStatus,r.prediction.riskLevel,r.prediction.confidence].join(","))].join(`
`),l=new Blob([s],{type:"text/csv"}),o=window.URL.createObjectURL(l),p=document.createElement("a");p.href=o,p.download=`predictions-${(t==null?void 0:t.title)||"event"}-${new Date().toISOString().split("T")[0]}.csv`,p.click(),window.URL.revokeObjectURL(o),j.success("Prédictions exportées avec succès")},h=D();return e.jsxs("div",{className:"container-fluid py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-foreground flex items-center",children:[e.jsx(I,{className:"w-8 h-8 mr-3 text-primary"}),"Prédictions de Présence"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Prédictions IA pour les événements à venir"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(f,{variant:"outline",onClick:B,disabled:i.length===0,children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"Exporter"]}),e.jsxs(f,{variant:"outline",onClick:T,disabled:!t,children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Actualiser"]})]})]}),e.jsxs(c,{children:[e.jsx(z,{children:e.jsxs(H,{className:"flex items-center",children:[e.jsx(k,{className:"w-5 h-5 mr-2"}),"Sélection d'événement"]})}),e.jsx(d,{children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs(g,{value:(t==null?void 0:t.id)||"",onValueChange:s=>{const l=b.find(o=>o.id===s);S(l||null)},children:[e.jsx(v,{children:e.jsx(N,{placeholder:"Sélectionner un événement"})}),e.jsx(w,{children:b.map(s=>e.jsx(n,{value:s.id,children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{children:s.title}),e.jsxs(V,{variant:"outline",className:"ml-2",children:[s.participants.length," participants"]})]})},s.id))})]})}),t&&e.jsx("div",{className:"text-sm text-muted-foreground",children:new Date(t.startDateTime).toLocaleString("fr-FR")})]})})]}),h&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx(c,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Participants"}),e.jsx("p",{className:"text-2xl font-bold",children:h.totalPredictions})]}),e.jsx(O,{className:"w-8 h-8 text-blue-600"})]})})}),e.jsx(c,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Taux de Présence Prédit"}),e.jsxs("p",{className:"text-2xl font-bold",children:[h.attendanceRate,"%"]})]}),e.jsx(Y,{className:"w-8 h-8 text-green-600"})]})})}),e.jsx(c,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Risque Élevé"}),e.jsx("p",{className:"text-2xl font-bold",children:h.highRisk})]}),e.jsx(Z,{className:"w-8 h-8 text-red-600"})]})})}),e.jsx(c,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Confiance Moyenne"}),e.jsxs("p",{className:"text-2xl font-bold",children:[h.averageConfidence,"%"]})]}),e.jsx(Q,{className:"w-8 h-8 text-purple-600"})]})})})]}),e.jsx(c,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx($,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(_,{placeholder:"Rechercher un participant...",value:m,onChange:s=>R(s.target.value),className:"pl-10"})]})}),e.jsxs(g,{value:u,onValueChange:s=>y(s),children:[e.jsx(v,{className:"w-[150px]",children:e.jsx(N,{placeholder:"Niveau de risque"})}),e.jsxs(w,{children:[e.jsx(n,{value:"all",children:"Tous les risques"}),e.jsx(n,{value:"high",children:"Risque élevé"}),e.jsx(n,{value:"medium",children:"Risque moyen"}),e.jsx(n,{value:"low",children:"Risque faible"})]})]}),e.jsxs(g,{value:x,onValueChange:s=>P(s),children:[e.jsx(v,{className:"w-[150px]",children:e.jsx(N,{placeholder:"Statut prédit"})}),e.jsxs(w,{children:[e.jsx(n,{value:"all",children:"Tous les statuts"}),e.jsx(n,{value:"present",children:"Présent"}),e.jsx(n,{value:"late",children:"En retard"}),e.jsx(n,{value:"absent",children:"Absent"}),e.jsx(n,{value:"excused",children:"Excusé"})]})]})]})})}),q?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((s,l)=>e.jsx("div",{className:"h-64 bg-muted rounded animate-pulse"},l))}):A.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:A.map(s=>e.jsx(G,{userId:s.userId,eventId:s.eventId,userName:s.userName,compact:!1,showFactors:!0,showRecommendations:!0},s.userId))}):t?e.jsx(c,{children:e.jsxs(d,{className:"p-12 text-center",children:[e.jsx(I,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:"Aucune prédiction trouvée"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:m||u!=="all"||x!=="all"?"Aucune prédiction ne correspond aux filtres sélectionnés.":"Aucune prédiction disponible pour cet événement."}),(m||u!=="all"||x!=="all")&&e.jsx(f,{variant:"outline",onClick:()=>{R(""),y("all"),P("all")},children:"Réinitialiser les filtres"})]})}):e.jsx(c,{children:e.jsxs(d,{className:"p-12 text-center",children:[e.jsx(k,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:"Sélectionnez un événement"}),e.jsx("p",{className:"text-muted-foreground",children:"Choisissez un événement pour voir les prédictions de présence."})]})})]})};export{we as default};
//# sourceMappingURL=PredictionsPage-DmibxLNF.js.map
