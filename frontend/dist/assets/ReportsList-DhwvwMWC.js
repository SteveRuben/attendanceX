import{c as ee,K as i,j as e,R as se,T as te,N as ae,g as D,O as re,X as ne,Q as le,V as ie,W as ce,w as oe,z as de,y as x,a as m,E as B,L as G,C as I,o as me,D as ue,U as pe,B as M}from"./index-gm4XY7Dh.js";import{r as u}from"./vendor-CvUQ7FSA.js";import{C as _,a as z}from"./Card-ct0JxCCf.js";import{I as T}from"./Input-BoijLIkg.js";import{S as y,a as N,b,c as C,d as r}from"./select-byvKiojp.js";import{L as w}from"./label-B3NocW4B.js";import{D as L}from"./download-C1GnnIYf.js";import{C as V}from"./clock-Tx-U9-MC.js";import{C as O}from"./circle-alert-B-efKsjX.js";import{C as xe}from"./circle-x-B_KOwtkV.js";import{C as he}from"./circle-check-big-eEft8Q46.js";import"./firebase-De9GV7Vy.js";import"./index-TMJn6bF9.js";import"./chevron-down-L5bpcUyJ.js";import"./check-Cx9i6ejF.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],fe=ee("file-text",ge);class je{async generateReport(t){return i.post("/reports/generate",t)}async previewReport(t){return i.post("/reports/preview",t)}async getReports(t={}){return i.get("/reports",t)}async getReportById(t){return i.get(`/reports/${t}`)}async downloadReport(t){return i.get(`/reports/${t}/download`)}async deleteReport(t){return i.delete(`/reports/${t}`)}async getReportStats(t={}){return i.get("/reports/stats",t)}async scheduleReport(t){return i.post("/reports/schedule",t)}async getReportTemplates(){return i.get("/reports/templates")}async getReportTemplate(t){return i.get(`/reports/templates/${t}`)}async generateAttendanceReport(t,p="pdf"){return i.post(`/reports/attendance/${t}`,{},{format:p})}async generateUserReport(t,p={}){return i.post(`/reports/user/${t}`,{},p)}async generateMonthlySummary(t){return i.post("/reports/monthly-summary",{},t)}async cleanupExpiredReports(){return i.post("/reports/cleanup-expired")}}const R=new je;function ve({...n}){return e.jsx(se,{"data-slot":"dialog",...n})}function ye({...n}){return e.jsx(te,{"data-slot":"dialog-trigger",...n})}function Ne({...n}){return e.jsx(ie,{"data-slot":"dialog-portal",...n})}function be({className:n,...t}){return e.jsx(ce,{"data-slot":"dialog-overlay",className:D("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",n),...t})}function Ce({className:n,children:t,showCloseButton:p=!0,...g}){return e.jsxs(Ne,{"data-slot":"dialog-portal",children:[e.jsx(be,{}),e.jsxs(ae,{"data-slot":"dialog-content",className:D("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",n),...g,children:[t,p&&e.jsxs(re,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[e.jsx(ne,{}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function we({className:n,...t}){return e.jsx("div",{"data-slot":"dialog-header",className:D("flex flex-col gap-2 text-center sm:text-left",n),...t})}function Re({className:n,...t}){return e.jsx(le,{"data-slot":"dialog-title",className:D("text-lg leading-none font-semibold",n),...t})}const Ve=()=>{const{user:n}=oe(),{canViewReports:t,canManageReports:p}=de(),[g,$]=u.useState([]),[H,P]=u.useState(!0),[E,F]=u.useState(!1),[U,f]=u.useState(!1),[c,q]=u.useState({search:"",type:"all",status:"all",format:"all"}),[d,h]=u.useState({type:"attendance_summary",format:"pdf",filters:{startDate:"",endDate:"",eventId:"",userId:"",department:""},options:{includeCharts:!0,includeInsights:!0,language:"fr"}}),[o,j]=u.useState({page:1,limit:20,total:0,totalPages:0});u.useEffect(()=>{S()},[c,o.page]);const S=async()=>{try{P(!0);const s={page:o.page,limit:o.limit,sortBy:"createdAt",sortOrder:"desc"};c.search&&(s.search=c.search),c.type!=="all"&&(s.type=c.type),c.status!=="all"&&(s.status=c.status),c.format!=="all"&&(s.format=c.format);const a=await R.getReports(s);a.success&&a.data&&($(a.data.data),j(l=>({...l,total:a.data.pagination.total,totalPages:a.data.pagination.totalPages})))}catch(s){console.error("Error loading reports:",s),x.error("Erreur lors du chargement des rapports")}finally{P(!1)}},k=(s,a)=>{q(l=>({...l,[s]:a})),j(l=>({...l,page:1}))},J=s=>{const l={pending:{variant:"secondary",label:"En attente",icon:V},processing:{variant:"default",label:"En cours",icon:G},completed:{variant:"default",label:"Terminé",icon:he},failed:{variant:"destructive",label:"Échec",icon:xe}}[s]||{variant:"outline",label:s,icon:O},v=l.icon;return e.jsxs(M,{variant:l.variant,className:"flex items-center gap-1",children:[e.jsx(v,{className:`w-3 h-3 ${s==="processing"?"animate-spin":""}`}),l.label]})},K=s=>({attendance_summary:"Résumé des présences",event_detail:"Détail d'événement",user_attendance:"Présences utilisateur",department_analytics:"Analytics département",monthly_summary:"Résumé mensuel",custom:"Personnalisé"})[s]||s,X=s=>{const l={pdf:{variant:"destructive",label:"PDF"},excel:{variant:"default",label:"Excel"},csv:{variant:"secondary",label:"CSV"},json:{variant:"outline",label:"JSON"}}[s]||{variant:"outline",label:s};return e.jsx(M,{variant:l.variant,children:l.label})},Q=async()=>{try{F(!0),(await R.generateReport({type:d.type,format:d.format,filters:d.filters,options:d.options})).success&&(x.success("Génération du rapport lancée"),f(!1),S())}catch{x.error("Erreur lors de la génération du rapport")}finally{F(!1)}},W=async s=>{try{(await R.downloadReport(s)).success&&x.success("Téléchargement en cours")}catch{x.error("Erreur lors du téléchargement")}},Z=async s=>{try{await R.deleteReport(s),x.success("Rapport supprimé"),S()}catch{x.error("Erreur lors de la suppression")}},A=s=>new Date(s).toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),Y=s=>{if(s===0)return"0 B";const a=1024,l=["B","KB","MB","GB"],v=Math.floor(Math.log(s)/Math.log(a));return parseFloat((s/Math.pow(a,v)).toFixed(2))+" "+l[v]};return H&&g.length===0?e.jsx("div",{className:"container-fluid py-6",children:e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsx("div",{className:"h-8 bg-muted rounded w-1/3"}),e.jsx("div",{className:"grid gap-4",children:[...Array(5)].map((s,a)=>e.jsx("div",{className:"h-24 bg-muted rounded"},a))})]})}):e.jsxs("div",{className:"container-fluid py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Rapports"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Générez et consultez vos rapports d'analyse"})]}),t&&e.jsxs(ve,{open:U,onOpenChange:f,children:[e.jsx(ye,{asChild:!0,children:e.jsxs(m,{children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Générer un rapport"]})}),e.jsxs(Ce,{className:"max-w-2xl",children:[e.jsx(we,{children:e.jsx(Re,{children:"Générer un nouveau rapport"})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(w,{htmlFor:"type",children:"Type de rapport"}),e.jsxs(y,{value:d.type,onValueChange:s=>h(a=>({...a,type:s})),children:[e.jsx(N,{children:e.jsx(b,{})}),e.jsxs(C,{children:[e.jsx(r,{value:"attendance_summary",children:"Résumé des présences"}),e.jsx(r,{value:"event_detail",children:"Détail d'événement"}),e.jsx(r,{value:"user_attendance",children:"Présences utilisateur"}),e.jsx(r,{value:"department_analytics",children:"Analytics département"}),e.jsx(r,{value:"monthly_summary",children:"Résumé mensuel"})]})]})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"format",children:"Format"}),e.jsxs(y,{value:d.format,onValueChange:s=>h(a=>({...a,format:s})),children:[e.jsx(N,{children:e.jsx(b,{})}),e.jsxs(C,{children:[e.jsx(r,{value:"pdf",children:"PDF"}),e.jsx(r,{value:"excel",children:"Excel"}),e.jsx(r,{value:"csv",children:"CSV"}),e.jsx(r,{value:"json",children:"JSON"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(w,{htmlFor:"startDate",children:"Date de début"}),e.jsx(T,{type:"date",value:d.filters.startDate,onChange:s=>h(a=>({...a,filters:{...a.filters,startDate:s.target.value}}))})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"endDate",children:"Date de fin"}),e.jsx(T,{type:"date",value:d.filters.endDate,onChange:s=>h(a=>({...a,filters:{...a.filters,endDate:s.target.value}}))})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:d.options.includeCharts,onChange:s=>h(a=>({...a,options:{...a.options,includeCharts:s.target.checked}}))}),e.jsx("span",{children:"Inclure les graphiques"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:d.options.includeInsights,onChange:s=>h(a=>({...a,options:{...a.options,includeInsights:s.target.checked}}))}),e.jsx("span",{children:"Inclure les insights"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(m,{variant:"outline",onClick:()=>f(!1),children:"Annuler"}),e.jsxs(m,{onClick:Q,disabled:E,children:[E?e.jsx(G,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(I,{className:"w-4 h-4 mr-2"}),"Générer"]})]})]})]})]})]}),e.jsx(_,{children:e.jsx(z,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(me,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(T,{placeholder:"Rechercher des rapports...",value:c.search,onChange:s=>k("search",s.target.value),className:"pl-10"})]})}),e.jsxs(y,{value:c.type,onValueChange:s=>k("type",s),children:[e.jsx(N,{className:"w-[200px]",children:e.jsx(b,{placeholder:"Type"})}),e.jsxs(C,{children:[e.jsx(r,{value:"all",children:"Tous les types"}),e.jsx(r,{value:"attendance_summary",children:"Résumé présences"}),e.jsx(r,{value:"event_detail",children:"Détail événement"}),e.jsx(r,{value:"user_attendance",children:"Présences utilisateur"}),e.jsx(r,{value:"department_analytics",children:"Analytics département"}),e.jsx(r,{value:"monthly_summary",children:"Résumé mensuel"})]})]}),e.jsxs(y,{value:c.status,onValueChange:s=>k("status",s),children:[e.jsx(N,{className:"w-[150px]",children:e.jsx(b,{placeholder:"Statut"})}),e.jsxs(C,{children:[e.jsx(r,{value:"all",children:"Tous les statuts"}),e.jsx(r,{value:"pending",children:"En attente"}),e.jsx(r,{value:"processing",children:"En cours"}),e.jsx(r,{value:"completed",children:"Terminé"}),e.jsx(r,{value:"failed",children:"Échec"})]})]})]})})}),e.jsx("div",{className:"space-y-4",children:g.length>0?g.map(s=>e.jsx(_,{className:"card-interactive",children:e.jsxs(z,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(fe,{className:"w-8 h-8 text-blue-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:s.title||K(s.type)}),J(s.status),X(s.format)]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ue,{className:"w-4 h-4 mr-1"}),"Généré le ",A(s.generatedAt)]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(pe,{className:"w-4 h-4 mr-1"}),"Par ",s.generatedBy]}),s.fileSize&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(L,{className:"w-4 h-4 mr-1"}),Y(s.fileSize)]}),s.completedAt&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(V,{className:"w-4 h-4 mr-1"}),"Terminé le ",A(s.completedAt)]})]}),s.description&&e.jsx("p",{className:"text-muted-foreground text-sm mt-2",children:s.description})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[s.status==="completed"&&s.downloadUrl&&e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>W(s.id),children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Télécharger"]}),p&&e.jsx(m,{variant:"outline",size:"sm",onClick:()=>Z(s.id),children:"Supprimer"})]})]}),s.error&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-md",children:e.jsxs("p",{className:"text-sm text-red-600",children:[e.jsx(O,{className:"w-4 h-4 inline mr-2"}),"Erreur: ",s.error]})})]})},s.id)):e.jsx(_,{children:e.jsxs(z,{className:"p-12 text-center",children:[e.jsx(I,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:"Aucun rapport trouvé"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:Object.values(c).some(s=>s&&s!=="all")?"Aucun rapport ne correspond à vos critères de recherche.":"Vous n'avez pas encore généré de rapport."}),t&&e.jsxs(m,{onClick:()=>f(!0),children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Générer votre premier rapport"]})]})})}),o.totalPages>1&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Affichage de ",(o.page-1)*o.limit+1," à"," ",Math.min(o.page*o.limit,o.total)," sur ",o.total," rapports"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(m,{variant:"outline",size:"sm",onClick:()=>j(s=>({...s,page:s.page-1})),disabled:o.page===1,children:"Précédent"}),e.jsx(m,{variant:"outline",size:"sm",onClick:()=>j(s=>({...s,page:s.page+1})),disabled:o.page===o.totalPages,children:"Suivant"})]})]})]})};export{Ve as default};
//# sourceMappingURL=ReportsList-DhwvwMWC.js.map
