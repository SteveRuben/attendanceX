import{c as ie,w as ce,z as le,y as j,j as e,a as r,B as p,D as de,U as V,G as H,H as O,I as _,C as oe}from"./index-gm4XY7Dh.js";import{h as me,d as xe,r as v,L as G}from"./vendor-CvUQ7FSA.js";import{C as i,b as c,c as l,a as d}from"./Card-ct0JxCCf.js";import{T as ue,a as he,b as D,c as P}from"./tabs-unnrqVzs.js";import{A as E,a as S}from"./alert-dbwOQxjT.js";import{e as k}from"./eventService-DkagHfbT.js";import{a as je}from"./attendanceService-BE_yyzd4.js";import{A as pe}from"./AttendancePredictionCard-B0RI0VTX.js";import"./progress-BSuwBYA5.js";import{R as ve}from"./RecommendationPanel-BRi5PorH.js";import{C as b}from"./circle-alert-B-efKsjX.js";import{A as fe}from"./arrow-left-yMfWrytx.js";import{C as Ne}from"./copy-ettdnWv-.js";import{S as ge}from"./square-pen-Gln_tB11.js";import{C as ye}from"./clock-Tx-U9-MC.js";import{M as be}from"./map-pin-Dg8dt4LF.js";import{B as I}from"./brain-DppQ7xr_.js";import{C as T}from"./circle-check-big-eEft8Q46.js";import{T as we}from"./trending-up-CbsLnhxQ.js";import{Q as X}from"./qr-code-CxuDgFNJ.js";import{D as J}from"./download-C1GnnIYf.js";import{C as K}from"./circle-x-B_KOwtkV.js";import"./firebase-De9GV7Vy.js";import"./mlService-CJ6D2i2K.js";import"./triangle-alert-CMRBmGwV.js";import"./info-b7pG8t1m.js";import"./arrow-right-BwqWpyzD.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],Ae=ie("share-2",Ce),es=()=>{var M,F;const{id:u}=me(),f=xe(),{user:De}=ce(),{canManageEvents:$,canViewAttendances:x}=le(),[t,L]=v.useState(null),[m,W]=v.useState([]),[Y,R]=v.useState(!0),[Z,q]=v.useState(!1),[o,ee]=v.useState({totalParticipants:0,totalAttendances:0,presentCount:0,absentCount:0,lateCount:0,attendanceRate:0});v.useEffect(()=>{u&&(se(),te())},[u]);const se=async()=>{try{R(!0);const s=await k.getEventById(u);s.success&&s.data?(L(s.data),ae(s.data)):(j.error("Événement non trouvé"),f("/events"))}catch(s){console.error("Error loading event:",s),j.error("Erreur lors du chargement de l'événement"),f("/events")}finally{R(!1)}},te=async()=>{if(x)try{q(!0);const s=await je.getEventAttendances(u);s.success&&s.data&&W(s.data)}catch(s){console.error("Error loading attendances:",s)}finally{q(!1)}},ae=s=>{var Q;const n=((Q=s.participants)==null?void 0:Q.length)||0,a=m.filter(y=>y.status==="present").length,h=m.filter(y=>y.status==="absent").length,C=m.filter(y=>y.status==="late").length,A=n>0?a/n*100:0;ee({totalParticipants:n,totalAttendances:m.length,presentCount:a,absentCount:h,lateCount:C,attendanceRate:A})},z=s=>{const a={draft:{variant:"secondary",label:"Brouillon"},published:{variant:"default",label:"Publié"},ongoing:{variant:"default",label:"En cours"},completed:{variant:"outline",label:"Terminé"},cancelled:{variant:"destructive",label:"Annulé"}}[s]||{variant:"outline",label:s};return e.jsx(p,{variant:a.variant,children:a.label})},B=s=>{const a={present:{variant:"default",label:"Présent",icon:T},absent:{variant:"destructive",label:"Absent",icon:K},late:{variant:"secondary",label:"En retard",icon:b},excused:{variant:"outline",label:"Excusé",icon:b}}[s]||{variant:"outline",label:s,icon:b},h=a.icon;return e.jsxs(p,{variant:a.variant,className:"flex items-center gap-1",children:[e.jsx(h,{className:"w-3 h-3"}),a.label]})},U=s=>{var n;if(s!=null&&s.firstName&&(s!=null&&s.lastName))return`${s.firstName[0]}${s.lastName[0]}`.toUpperCase();if(s!=null&&s.displayName){const a=s.displayName.split(" ");return a.length>1?`${a[0][0]}${a[1][0]}`.toUpperCase():a[0][0].toUpperCase()}return((n=s==null?void 0:s.email)==null?void 0:n[0].toUpperCase())||"U"},N=s=>new Date(s).toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}),ne=async()=>{try{const s=await k.duplicateEvent(u);s.success&&(j.success("Événement dupliqué avec succès"),f(`/events/${s.data.id}`))}catch{j.error("Erreur lors de la duplication")}},re=async s=>{try{(await k.changeEventStatus(u,s)).success&&(L(a=>a?{...a,status:s}:null),j.success("Statut mis à jour"))}catch{j.error("Erreur lors de la mise à jour du statut")}},g=t?new Date(t.endDate)<new Date:!1,w=t?new Date(t.startDate)<=new Date&&new Date(t.endDate)>=new Date:!1;return Y?e.jsx("div",{className:"container-fluid py-6",children:e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsx("div",{className:"h-8 bg-muted rounded w-1/3"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx("div",{className:"h-64 bg-muted rounded"}),e.jsx("div",{className:"h-48 bg-muted rounded"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-32 bg-muted rounded"}),e.jsx("div",{className:"h-48 bg-muted rounded"})]})]})]})}):t?e.jsxs("div",{className:"container-fluid py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>f("/events"),children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),"Retour"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:t.title}),e.jsxs("div",{className:"flex items-center space-x-3 mt-2",children:[z(t.status),e.jsx(p,{variant:"outline",children:t.type}),w&&e.jsx(p,{variant:"default",className:"animate-pulse",children:"En cours"})]})]})]}),$&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(r,{variant:"outline",size:"sm",onClick:ne,children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Dupliquer"]}),e.jsx(r,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(G,{to:`/events/${t.id}/edit`,children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),"Modifier"]})}),e.jsxs(r,{variant:"outline",size:"sm",children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Partager"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(i,{children:[e.jsx(c,{children:e.jsx(l,{children:"Informations de l'événement"})}),e.jsxs(d,{className:"space-y-4",children:[t.description&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Description"}),e.jsx("p",{className:"text-muted-foreground",children:t.description})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(de,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Date de début"}),e.jsx("p",{className:"text-muted-foreground",children:N(t.startDate)})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ye,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Date de fin"}),e.jsx("p",{className:"text-muted-foreground",children:N(t.endDate)})]})]}),t.location&&e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(be,{className:"w-5 h-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Lieu"}),e.jsx("p",{className:"text-muted-foreground",children:t.location.name}),t.location.address&&e.jsx("p",{className:"text-sm text-muted-foreground",children:t.location.address})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(V,{className:"w-5 h-5 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Participants"}),e.jsxs("p",{className:"text-muted-foreground",children:[o.totalParticipants," invités"]})]})]})]})]})]}),x&&e.jsxs(i,{children:[e.jsx(c,{children:e.jsx(l,{children:"Statistiques de présence"})}),e.jsx(d,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:o.presentCount}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Présents"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:o.absentCount}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Absents"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:o.lateCount}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"En retard"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[o.attendanceRate.toFixed(1),"%"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Taux de présence"})]})]})})]}),e.jsxs(ue,{defaultValue:"participants",className:"space-y-4",children:[e.jsxs(he,{children:[e.jsxs(D,{value:"participants",children:["Participants (",o.totalParticipants,")"]}),x&&e.jsxs(D,{value:"attendances",children:["Présences (",o.totalAttendances,")"]}),x&&!g&&e.jsxs(D,{value:"predictions",children:[e.jsx(I,{className:"w-4 h-4 mr-1"}),"Prédictions IA"]}),e.jsx(D,{value:"details",children:"Détails"})]}),e.jsx(P,{value:"participants",children:e.jsxs(i,{children:[e.jsx(c,{children:e.jsx(l,{children:"Liste des participants"})}),e.jsx(d,{children:t.participants&&t.participants.length>0?e.jsx("div",{className:"space-y-3",children:t.participants.map(s=>{var n;return e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(H,{className:"w-8 h-8",children:[e.jsx(O,{src:s.profilePicture}),e.jsx(_,{children:U(s)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.displayName||`${s.firstName} ${s.lastName}`}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.email})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(p,{variant:"outline",children:s.role}),m.find(a=>a.userId===s.id)&&B(((n=m.find(a=>a.userId===s.id))==null?void 0:n.status)||"absent")]})]},s.id)})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(V,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Aucun participant invité"})]})})]})}),x&&e.jsx(P,{value:"attendances",children:e.jsxs(i,{children:[e.jsx(c,{children:e.jsx(l,{children:"Présences enregistrées"})}),e.jsx(d,{children:Z?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Chargement des présences..."})]}):m.length>0?e.jsx("div",{className:"space-y-3",children:m.map(s=>{var n,a,h,C,A;return e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(H,{className:"w-8 h-8",children:[e.jsx(O,{src:(n=s.user)==null?void 0:n.profilePicture}),e.jsx(_,{children:U(s.user)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:((a=s.user)==null?void 0:a.displayName)||`${(h=s.user)==null?void 0:h.firstName} ${(C=s.user)==null?void 0:C.lastName}`||((A=s.user)==null?void 0:A.email)}),s.checkInTime&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Arrivé le ",N(s.checkInTime)]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[B(s.status),e.jsx(p,{variant:"outline",children:s.method})]})]},s.id)})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(T,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Aucune présence enregistrée"})]})})]})}),x&&!g&&e.jsx(P,{value:"predictions",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(i,{children:[e.jsx(c,{children:e.jsxs(l,{className:"flex items-center",children:[e.jsx(I,{className:"w-5 h-5 mr-2 text-primary"}),"Prédictions de Présence IA"]})}),e.jsxs(d,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:Math.round(o.totalParticipants*.85)}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Présence prédite"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:"85%"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Taux prédit"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:"92%"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Confiance IA"})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Les prédictions sont basées sur l'historique de présence, les patterns comportementaux et les caractéristiques de l'événement."})]})]}),e.jsxs(i,{children:[e.jsx(c,{children:e.jsx(l,{children:"Prédictions par participant"})}),e.jsxs(d,{children:[t.participants&&t.participants.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:t.participants.slice(0,6).map(s=>e.jsx(pe,{userId:s.id,eventId:t.id,userName:s.displayName||`${s.firstName} ${s.lastName}`,compact:!0,showFactors:!1,showRecommendations:!1},s.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(I,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Aucun participant pour les prédictions"})]}),t.participants&&t.participants.length>6&&e.jsx("div",{className:"text-center mt-4",children:e.jsxs(r,{variant:"outline",onClick:()=>f("/predictions"),children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),"Voir toutes les prédictions (",t.participants.length,")"]})})]})]}),e.jsx(ve,{type:"event",targetId:t.id,context:{eventType:t.type,participantCount:o.totalParticipants},maxRecommendations:3,showPriority:!0,showActions:!0})]})}),e.jsx(P,{value:"details",children:e.jsxs(i,{children:[e.jsx(c,{children:e.jsx(l,{children:"Détails techniques"})}),e.jsx(d,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"ID de l'événement"}),e.jsx("p",{className:"text-muted-foreground font-mono text-sm",children:t.id})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Créé le"}),e.jsx("p",{className:"text-muted-foreground",children:N(t.createdAt)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Organisateur"}),e.jsx("p",{className:"text-muted-foreground",children:((M=t.organizer)==null?void 0:M.displayName)||((F=t.organizer)==null?void 0:F.email)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Dernière modification"}),e.jsx("p",{className:"text-muted-foreground",children:N(t.updatedAt)})]})]})})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(i,{children:[e.jsx(c,{children:e.jsx(l,{children:"Actions rapides"})}),e.jsxs(d,{className:"space-y-3",children:[w&&e.jsx(r,{className:"w-full",asChild:!0,children:e.jsxs(G,{to:`/attendances/mark/${t.id}`,children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Marquer les présences"]})}),x&&e.jsxs(r,{variant:"outline",className:"w-full",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Exporter les présences"]}),e.jsxs(r,{variant:"outline",className:"w-full",children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"Voir les analytics"]}),$&&t.status==="published"&&!g&&e.jsxs(r,{variant:"outline",className:"w-full",onClick:()=>re("cancelled"),children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Annuler l'événement"]})]})]}),e.jsxs(i,{children:[e.jsx(c,{children:e.jsx(l,{children:"Statut de l'événement"})}),e.jsx(d,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Statut actuel"}),z(t.status)]}),g&&e.jsxs(E,{children:[e.jsx(b,{className:"h-4 w-4"}),e.jsx(S,{children:"Cet événement est terminé."})]}),w&&e.jsxs(E,{children:[e.jsx(T,{className:"h-4 w-4"}),e.jsx(S,{children:"Cet événement est actuellement en cours."})]})]})})]}),(w||!g)&&e.jsxs(i,{children:[e.jsx(c,{children:e.jsx(l,{children:"Code QR de l'événement"})}),e.jsxs(d,{className:"text-center",children:[e.jsx("div",{className:"w-32 h-32 bg-muted rounded-lg mx-auto mb-4 flex items-center justify-center",children:e.jsx(X,{className:"w-16 h-16 text-muted-foreground"})}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"Scannez ce code pour marquer votre présence"}),e.jsxs(r,{variant:"outline",size:"sm",className:"w-full",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Télécharger le QR Code"]})]})]})]})]})]}):e.jsx("div",{className:"container-fluid py-6",children:e.jsxs(E,{variant:"destructive",children:[e.jsx(b,{className:"h-4 w-4"}),e.jsx(S,{children:"Événement non trouvé ou vous n'avez pas les permissions pour le voir."})]})})};export{es as default};
//# sourceMappingURL=EventDetails-DQ-ssJJS.js.map
