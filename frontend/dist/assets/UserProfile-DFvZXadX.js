import{w as W,z as Y,y,j as e,a as j,n as Z,G as ee,H as se,I as te,D as w,B as v,x as C,C as ae,S as F}from"./index-gm4XY7Dh.js";import{h as re,d as ie,r as x}from"./vendor-CvUQ7FSA.js";import{C as c,b as l,c as d,a as o}from"./Card-ct0JxCCf.js";import{T as ne,a as ce,b as A,c as S}from"./tabs-unnrqVzs.js";import{A as M,a as $}from"./alert-dbwOQxjT.js";import{u as E}from"./userService-LLdjq6tZ.js";import{e as le}from"./eventService-DkagHfbT.js";import{a as z}from"./attendanceService-BE_yyzd4.js";import{C as u}from"./circle-x-B_KOwtkV.js";import{A as de}from"./arrow-left-yMfWrytx.js";import{U as oe}from"./user-x-B0h_aedd.js";import{U as V}from"./user-check-C2Vgj06z.js";import{S as me}from"./square-pen-Gln_tB11.js";import{M as xe}from"./mail-Bm_S11fa.js";import{P as ue}from"./phone-CXGJeqaQ.js";import{B as he}from"./building-C4sNiXDP.js";import{C as N}from"./circle-check-big-eEft8Q46.js";import{C as q}from"./clock-Tx-U9-MC.js";import"./firebase-De9GV7Vy.js";const Te=()=>{const{id:g}=re(),U=ie(),{user:m}=W(),{canManageUsers:D,canViewReports:p}=Y(),[t,P]=x.useState(null),[H,I]=x.useState(!0),[i,O]=x.useState({totalEvents:0,attendedEvents:0,attendanceRate:0,totalPresent:0,totalAbsent:0,totalLate:0,averageCheckInTime:"",streak:0}),[R,X]=x.useState([]),[k,G]=x.useState([]),n=!g||g===(m==null?void 0:m.id),h=n?m==null?void 0:m.id:g;x.useEffect(()=>{h&&(J(),_())},[h]);const J=async()=>{try{I(!0);let s;if(n){const a=await E.getMyProfile();if(!a.success||!a.data)throw new Error("Impossible de charger votre profil");s=a.data}else{const a=await E.getUserById(h);if(!a.success||!a.data)throw new Error("Utilisateur non trouvé");s=a.data}P(s)}catch(s){console.error("Error loading user profile:",s),y.error(s.message||"Erreur lors du chargement du profil"),n||U("/users")}finally{I(!1)}},_=async()=>{try{const s=await z.getAttendanceStats({userId:h});s.success&&s.data&&O(s.data);const a=await z.getMyAttendances({limit:10});if(a.success&&a.data&&X(a.data),p){const r=await le.getEvents({participantId:h,status:"published",limit:5});r.success&&r.data&&G(r.data.data)}}catch(s){console.error("Error loading user stats:",s)}},T=s=>{const r={super_admin:{variant:"destructive",label:"Super Admin",icon:F},admin:{variant:"destructive",label:"Admin",icon:F},organizer:{variant:"default",label:"Organisateur",icon:C},moderator:{variant:"secondary",label:"Modérateur",icon:V},analyst:{variant:"outline",label:"Analyste",icon:ae},participant:{variant:"outline",label:"Participant",icon:C}}[s]||{variant:"outline",label:s,icon:C},b=r.icon;return e.jsxs(v,{variant:r.variant,className:"flex items-center gap-1",children:[e.jsx(b,{className:"w-3 h-3"}),r.label]})},L=s=>{const r={active:{variant:"default",label:"Actif",icon:N},inactive:{variant:"secondary",label:"Inactif",icon:u},pending:{variant:"outline",label:"En attente",icon:q},suspended:{variant:"destructive",label:"Suspendu",icon:u}}[s]||{variant:"outline",label:s,icon:q},b=r.icon;return e.jsxs(v,{variant:r.variant,className:"flex items-center gap-1",children:[e.jsx(b,{className:"w-3 h-3"}),r.label]})},K=s=>{if(s.firstName&&s.lastName)return`${s.firstName[0]}${s.lastName[0]}`.toUpperCase();if(s.displayName){const a=s.displayName.split(" ");return a.length>1?`${a[0][0]}${a[1][0]}`.toUpperCase():a[0][0].toUpperCase()}return s.email[0].toUpperCase()},Q=s=>new Date(s).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"}),f=s=>new Date(s).toLocaleDateString("fr-FR",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}),B=async s=>{if(!(!t||!D))try{(await E.changeUserStatus(t.id,s)).success&&(P(r=>r?{...r,status:s}:null),y.success("Statut utilisateur mis à jour"))}catch{y.error("Erreur lors de la mise à jour du statut")}};return H?e.jsx("div",{className:"container-fluid py-6",children:e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsx("div",{className:"h-8 bg-muted rounded w-1/3"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx("div",{className:"h-64 bg-muted rounded"}),e.jsx("div",{className:"h-48 bg-muted rounded"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-32 bg-muted rounded"}),e.jsx("div",{className:"h-48 bg-muted rounded"})]})]})]})}):t?e.jsxs("div",{className:"container-fluid py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[!n&&e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>U("/users"),children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),"Retour"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:n?"Mon profil":"Profil utilisateur"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:t.displayName||`${t.firstName} ${t.lastName}`})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[n&&e.jsxs(j,{variant:"outline",size:"sm",children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"Paramètres"]}),D&&!n&&e.jsxs(e.Fragment,{children:[t.status==="active"?e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>B("inactive"),children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"Désactiver"]}):e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>B("active"),children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Activer"]}),e.jsxs(j,{variant:"outline",size:"sm",children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Modifier"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(c,{children:[e.jsx(l,{children:e.jsx(d,{children:"Informations personnelles"})}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-start space-x-6",children:[e.jsxs(ee,{className:"w-24 h-24",children:[e.jsx(se,{src:t.profilePicture}),e.jsx(te,{className:"text-2xl",children:K(t)})]}),e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:t.displayName||`${t.firstName} ${t.lastName}`}),T(t.role),L(t.status)]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(xe,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Email"}),e.jsx("p",{className:"text-muted-foreground",children:t.email})]})]}),t.phone&&e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ue,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Téléphone"}),e.jsx("p",{className:"text-muted-foreground",children:t.phone})]})]}),t.department&&e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(he,{className:"w-5 h-5 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Département"}),e.jsx("p",{className:"text-muted-foreground",children:t.department})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(w,{className:"w-5 h-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Membre depuis"}),e.jsx("p",{className:"text-muted-foreground",children:Q(t.createdAt)})]})]})]})]})]})})]}),p&&e.jsxs(c,{children:[e.jsx(l,{children:e.jsx(d,{children:"Statistiques de présence"})}),e.jsx(o,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:i.totalEvents}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Événements"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:i.attendedEvents}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Participés"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[i.attendanceRate.toFixed(1),"%"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Taux présence"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:i.streak}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Série actuelle"})]})]})})]}),e.jsxs(ne,{defaultValue:"activity",className:"space-y-4",children:[e.jsxs(ce,{children:[e.jsx(A,{value:"activity",children:"Activité récente"}),p&&e.jsx(A,{value:"events",children:"Événements à venir"}),e.jsx(A,{value:"details",children:"Détails du compte"})]}),e.jsx(S,{value:"activity",children:e.jsxs(c,{children:[e.jsx(l,{children:e.jsx(d,{children:"Présences récentes"})}),e.jsx(o,{children:R.length>0?e.jsx("div",{className:"space-y-3",children:R.map(s=>{var a;return e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${s.status==="present"?"bg-green-500":s.status==="late"?"bg-yellow-500":"bg-red-500"}`}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:(a=s.event)==null?void 0:a.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.checkInTime?f(s.checkInTime):"Non marqué"})]})]}),e.jsx(v,{variant:s.status==="present"?"default":s.status==="late"?"secondary":"destructive",children:s.status==="present"?"Présent":s.status==="late"?"En retard":"Absent"})]},s.id)})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(N,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Aucune activité récente"})]})})]})}),p&&e.jsx(S,{value:"events",children:e.jsxs(c,{children:[e.jsx(l,{children:e.jsx(d,{children:"Événements à venir"})}),e.jsx(o,{children:k.length>0?e.jsx("div",{className:"space-y-3",children:k.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(w,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:f(s.startDate)})]})]}),e.jsx(v,{variant:"outline",children:s.type})]},s.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(w,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Aucun événement à venir"})]})})]})}),e.jsx(S,{value:"details",children:e.jsxs(c,{children:[e.jsx(l,{children:e.jsx(d,{children:"Détails du compte"})}),e.jsx(o,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"ID utilisateur"}),e.jsx("p",{className:"text-muted-foreground font-mono text-sm",children:t.id})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Email vérifié"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[t.emailVerified?e.jsx(N,{className:"w-4 h-4 text-green-600"}):e.jsx(u,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:"text-muted-foreground",children:t.emailVerified?"Vérifié":"Non vérifié"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"2FA activé"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[t.twoFactorEnabled?e.jsx(N,{className:"w-4 h-4 text-green-600"}):e.jsx(u,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:"text-muted-foreground",children:t.twoFactorEnabled?"Activé":"Désactivé"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Dernière connexion"}),e.jsx("p",{className:"text-muted-foreground",children:t.lastLoginAt?f(t.lastLoginAt):"Jamais"})]})]})})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(c,{children:[e.jsx(l,{children:e.jsx(d,{children:"Résumé"})}),e.jsxs(o,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Présences"}),e.jsx("span",{className:"font-medium",children:i.totalPresent})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Absences"}),e.jsx("span",{className:"font-medium",children:i.totalAbsent})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Retards"}),e.jsx("span",{className:"font-medium",children:i.totalLate})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Taux de présence"}),e.jsxs("span",{className:"font-medium",children:[i.attendanceRate.toFixed(1),"%"]})]})]})]}),e.jsxs(c,{children:[e.jsx(l,{children:e.jsx(d,{children:"Statut du compte"})}),e.jsxs(o,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Statut"}),L(t.status)]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Rôle"}),T(t.role)]}),t.accountLockedUntil&&new Date(t.accountLockedUntil)>new Date&&e.jsxs(M,{variant:"destructive",children:[e.jsx(u,{className:"h-4 w-4"}),e.jsxs($,{children:["Compte verrouillé jusqu'au ",f(t.accountLockedUntil)]})]})]})]})]})]})]}):e.jsx("div",{className:"container-fluid py-6",children:e.jsxs(M,{variant:"destructive",children:[e.jsx(u,{className:"h-4 w-4"}),e.jsx($,{children:"Utilisateur non trouvé ou vous n'avez pas les permissions pour voir ce profil."})]})})};export{Te as default};
//# sourceMappingURL=UserProfile-DFvZXadX.js.map
