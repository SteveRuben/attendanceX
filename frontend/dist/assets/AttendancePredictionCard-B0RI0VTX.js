import{y as P,j as e,a as y,x as v,B as i}from"./index-gm4XY7Dh.js";import{r as n}from"./vendor-CvUQ7FSA.js";import{C as c,a as l,b as E,c as L}from"./Card-ct0JxCCf.js";import{P as w}from"./progress-BSuwBYA5.js";import{m as r,T as I,a as R}from"./mlService-CJ6D2i2K.js";import{T as C}from"./triangle-alert-CMRBmGwV.js";import{B as F}from"./brain-DppQ7xr_.js";import{T as z}from"./trending-up-CbsLnhxQ.js";import{I as D}from"./info-b7pG8t1m.js";import{C as q}from"./clock-Tx-U9-MC.js";import{C as G}from"./circle-check-big-eEft8Q46.js";const Z=({userId:u,eventId:f,userName:h,compact:d=!1,showFactors:p=!0,showRecommendations:S=!0,onPredictionUpdate:m})=>{const[s,k]=n.useState(null),[A,j]=n.useState(!0),[N,o]=n.useState(null);n.useEffect(()=>{x()},[u,f]);const x=async()=>{try{j(!0),o(null);const t=await r.predictAttendance({userId:u,eventId:f,includeFactors:p});t.success&&t.data?(k(t.data),m==null||m(t.data)):o("Impossible de charger la prédiction")}catch(t){o(t.message||"Erreur lors du chargement"),P.error("Erreur lors de la prédiction")}finally{j(!1)}},T=t=>t>=.8?"text-green-600":t>=.6?"text-yellow-600":"text-red-600",b=t=>{switch(t){case"low":return e.jsx(G,{className:"w-4 h-4 text-green-600"});case"medium":return e.jsx(q,{className:"w-4 h-4 text-yellow-600"});case"high":return e.jsx(C,{className:"w-4 h-4 text-red-600"});default:return e.jsx(D,{className:"w-4 h-4 text-gray-600"})}},g=(t,a)=>{const B={present:"default",late:"secondary",absent:"destructive",excused:"outline"};return e.jsxs(i,{variant:B[t]||"outline",children:[r.getStatusLabel(t)," (",r.formatProbability(a),")"]})};return A?e.jsx(c,{className:d?"h-32":"h-48",children:e.jsx(l,{className:"p-6 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):N||!s?e.jsx(c,{className:d?"h-32":"h-48",children:e.jsxs(l,{className:"p-6 flex flex-col items-center justify-center",children:[e.jsx(C,{className:"w-8 h-8 text-red-500 mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground text-center",children:N||"Aucune prédiction disponible"}),e.jsx(y,{variant:"outline",size:"sm",onClick:x,className:"mt-2",children:"Réessayer"})]})}):d?e.jsx(c,{className:"h-32",children:e.jsxs(l,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(v,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:h||"Utilisateur"})]}),b(s.prediction.riskLevel)]}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[g(s.prediction.expectedStatus,s.prediction.probability),e.jsxs(i,{variant:"outline",className:"text-xs",children:[r.getConfidenceIcon(s.prediction.confidence)," ",s.prediction.confidence]})]}),e.jsx(w,{value:s.prediction.probability*100,className:"h-2"})]})}):e.jsxs(c,{children:[e.jsx(E,{className:"pb-3",children:e.jsxs(L,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{className:"w-5 h-5 text-primary"}),e.jsx("span",{children:"Prédiction de Présence"})]}),e.jsxs(i,{variant:"outline",className:"text-xs",children:["IA v",s.modelVersion]})]})}),e.jsxs(l,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(v,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:h||s.userName})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Statut prédit:"}),g(s.prediction.expectedStatus,s.prediction.probability)]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Probabilité de présence"}),e.jsx("span",{className:`font-medium ${T(s.prediction.probability)}`,children:r.formatProbability(s.prediction.probability)})]}),e.jsx(w,{value:s.prediction.probability*100,className:"h-2"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Niveau de risque:"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[b(s.prediction.riskLevel),e.jsx("span",{className:"text-sm capitalize",children:s.prediction.riskLevel})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Confiance:"}),e.jsxs(i,{variant:"outline",className:"text-xs",children:[r.getConfidenceIcon(s.prediction.confidence)," ",s.prediction.confidence]})]})]}),p&&s.influencingFactors.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"text-sm font-medium flex items-center",children:[e.jsx(I,{className:"w-4 h-4 mr-1"}),"Facteurs d'influence"]}),e.jsx("div",{className:"space-y-1",children:s.influencingFactors.slice(0,3).map((t,a)=>e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"flex items-center",children:[t.direction==="positive"?e.jsx(z,{className:"w-3 h-3 text-green-500 mr-1"}):e.jsx(R,{className:"w-3 h-3 text-red-500 mr-1"}),t.name]}),e.jsxs("span",{className:"font-medium",children:[Math.round(t.impact*100),"%"]})]},a))})]}),S&&s.recommendations.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Recommandations"}),e.jsx("div",{className:"space-y-1",children:s.recommendations.slice(0,2).map((t,a)=>e.jsx("div",{className:"text-xs text-muted-foreground bg-muted p-2 rounded",children:t},a))})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Généré ",new Date(s.generatedAt).toLocaleString("fr-FR")]}),e.jsx(y,{variant:"outline",size:"sm",onClick:x,children:"Actualiser"})]})]})]})};export{Z as A};
//# sourceMappingURL=AttendancePredictionCard-B0RI0VTX.js.map
