import{w as J,z as K,A as Q,j as e,D as j,y as M,a,E as b,U as V,F as Y,C as ee,B as se}from"./index-gm4XY7Dh.js";import{r as c}from"./vendor-CvUQ7FSA.js";import{C as d,a as m,b as y,c as A}from"./Card-ct0JxCCf.js";import{u as te}from"./userService-LLdjq6tZ.js";import{e as _}from"./eventService-DkagHfbT.js";import{a as $}from"./attendanceService-BE_yyzd4.js";import"./progress-BSuwBYA5.js";import{I as ae,A as ie}from"./InsightsWidget-Cl0kgkMs.js";import{R as re}from"./RecommendationPanel-BRi5PorH.js";import{C as ne}from"./circle-check-big-eEft8Q46.js";import{R as le}from"./refresh-cw-dQTnxzmC.js";import{T as ce}from"./trending-up-CbsLnhxQ.js";import{C as de}from"./clock-Tx-U9-MC.js";import{M as me}from"./map-pin-Dg8dt4LF.js";import{A as F}from"./activity-Bg5ZGORh.js";import{B as oe}from"./brain-DppQ7xr_.js";import{Z as xe}from"./zap-BC5YElz6.js";import{T as ue}from"./mlService-CJ6D2i2K.js";import"./firebase-De9GV7Vy.js";import"./alert-dbwOQxjT.js";import"./triangle-alert-CMRBmGwV.js";import"./info-b7pG8t1m.js";import"./eye-2sExp-ov.js";import"./circle-alert-B-efKsjX.js";import"./arrow-right-BwqWpyzD.js";const _e=()=>{const{user:i}=J(),{canCreateEvents:p,canManageUsers:C,canViewReports:f,isAdmin:R}=K(),[G,E]=c.useState(!0),[n,L]=c.useState({totalEvents:0,upcomingEvents:0,totalUsers:0,activeUsers:0,attendanceRate:0,totalAttendances:0,pendingNotifications:0}),[D,Z]=c.useState([]),[he,q]=c.useState([]),[S,H]=c.useState([]),[U,I]=c.useState(!1);c.useEffect(()=>{T()},[]);const T=async()=>{var s;try{E(!0);const[r,h,k,B,z,O]=await Promise.allSettled([_.getEventStats(),_.getUpcomingEvents(5),$.getAttendanceStats(),R?te.getUserStats():Promise.resolve({data:null}),$.getMyAttendances({limit:5}),Q.getMyNotifications({limit:5,unreadOnly:!0})]),o=r.status==="fulfilled"?r.value.data:null,g=h.status==="fulfilled"?h.value.data:[],x=k.status==="fulfilled"?k.value.data:null,u=B.status==="fulfilled"?B.value.data:null,v=z.status==="fulfilled"?z.value.data:[],N=O.status==="fulfilled"?O.value.data:null;L({totalEvents:(o==null?void 0:o.total)||0,upcomingEvents:(o==null?void 0:o.upcoming)||0,totalUsers:(u==null?void 0:u.total)||0,activeUsers:(u==null?void 0:u.active)||0,attendanceRate:(x==null?void 0:x.attendanceRate)||0,totalAttendances:(x==null?void 0:x.total)||0,pendingNotifications:((s=N==null?void 0:N.pagination)==null?void 0:s.total)||0}),Z(g||[]),q(v||[]);const w=[];g&&g.slice(0,3).forEach(t=>{var l;w.push({id:`event-${t.id}`,type:"event_created",title:"Nouvel √©v√©nement",description:t.title,timestamp:t.createdAt,user:((l=t.organizer)==null?void 0:l.displayName)||"Organisateur",icon:e.jsx(j,{className:"w-4 h-4 text-blue-600"})})}),v&&v.slice(0,2).forEach(t=>{var l;w.push({id:`attendance-${t.id}`,type:"attendance_marked",title:"Pr√©sence marqu√©e",description:`√âv√©nement: ${((l=t.event)==null?void 0:l.title)||"N/A"}`,timestamp:t.checkInTime||t.createdAt,user:(i==null?void 0:i.displayName)||"Vous",icon:e.jsx(ne,{className:"w-4 h-4 text-green-600"})})}),H(w.sort((t,l)=>new Date(l.timestamp).getTime()-new Date(t.timestamp).getTime()).slice(0,5))}catch(r){console.error("Error loading dashboard data:",r),M.error("Erreur lors du chargement du tableau de bord")}finally{E(!1)}},W=async()=>{I(!0),await T(),I(!1),M.success("Tableau de bord actualis√©")},X=s=>{const h={active:{variant:"default",label:"Actif"},upcoming:{variant:"secondary",label:"√Ä venir"},ongoing:{variant:"default",label:"En cours"},completed:{variant:"outline",label:"Termin√©"},cancelled:{variant:"destructive",label:"Annul√©"},present:{variant:"default",label:"Pr√©sent"},absent:{variant:"destructive",label:"Absent"},late:{variant:"secondary",label:"En retard"}}[s]||{variant:"outline",label:s};return e.jsx(se,{variant:h.variant,children:h.label})},P=s=>new Date(s).toLocaleDateString("fr-FR",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"});return G?e.jsx("div",{className:"container-fluid py-6",children:e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsx("div",{className:"h-8 bg-muted rounded w-1/3"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[...Array(4)].map((s,r)=>e.jsx("div",{className:"h-32 bg-muted rounded"},r))}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[...Array(2)].map((s,r)=>e.jsx("div",{className:"h-96 bg-muted rounded"},r))})]})}):e.jsxs("div",{className:"container-fluid py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-foreground",children:["Bonjour, ",(i==null?void 0:i.firstName)||(i==null?void 0:i.displayName)," üëã"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Voici un aper√ßu de votre activit√© AttendanceX"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(a,{variant:"outline",size:"sm",onClick:W,disabled:U,children:[e.jsx(le,{className:`w-4 h-4 mr-2 ${U?"animate-spin":""}`}),"Actualiser"]}),p&&e.jsxs(a,{size:"sm",children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"Nouvel √©v√©nement"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(d,{className:"metric-card",children:e.jsx(m,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"metric-label",children:"√âv√©nements totaux"}),e.jsx("p",{className:"metric-value",children:n.totalEvents}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[n.upcomingEvents," √† venir"]})]}),e.jsx(j,{className:"w-8 h-8 text-blue-600"})]})})}),e.jsx(d,{className:"metric-card",children:e.jsx(m,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"metric-label",children:"Taux de pr√©sence"}),e.jsxs("p",{className:"metric-value",children:[n.attendanceRate.toFixed(1),"%"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[n.totalAttendances," pr√©sences"]})]}),e.jsx(ce,{className:"w-8 h-8 text-green-600"})]})})}),R&&e.jsx(d,{className:"metric-card",children:e.jsx(m,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"metric-label",children:"Utilisateurs"}),e.jsx("p",{className:"metric-value",children:n.totalUsers}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[n.activeUsers," actifs"]})]}),e.jsx(V,{className:"w-8 h-8 text-purple-600"})]})})}),e.jsx(d,{className:"metric-card",children:e.jsx(m,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"metric-label",children:"Notifications"}),e.jsx("p",{className:"metric-value",children:n.pendingNotifications}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Non lues"})]}),e.jsx(Y,{className:"w-8 h-8 text-orange-600"})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(d,{children:[e.jsxs(y,{className:"flex flex-row items-center justify-between",children:[e.jsxs(A,{className:"flex items-center",children:[e.jsx(j,{className:"w-5 h-5 mr-2"}),"√âv√©nements √† venir"]}),e.jsx(a,{variant:"outline",size:"sm",children:"Voir tout"})]}),e.jsx(m,{children:D.length>0?e.jsx("div",{className:"space-y-4",children:D.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-foreground",children:s.title}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(de,{className:"w-4 h-4 mr-1"}),P(s.startDate)]}),s.location&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(me,{className:"w-4 h-4 mr-1"}),s.location.name]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[X(s.status),e.jsx(a,{variant:"outline",size:"sm",children:"D√©tails"})]})]},s.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(j,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Aucun √©v√©nement √† venir"}),p&&e.jsxs(a,{className:"mt-4",size:"sm",children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"Cr√©er un √©v√©nement"]})]})})]})}),e.jsx("div",{children:e.jsxs(d,{children:[e.jsx(y,{children:e.jsxs(A,{className:"flex items-center",children:[e.jsx(F,{className:"w-5 h-5 mr-2"}),"Activit√© r√©cente"]})}),e.jsx(m,{children:S.length>0?e.jsx("div",{className:"space-y-4",children:S.map(s=>e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0 mt-1",children:s.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:s.description}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[P(s.timestamp)," ‚Ä¢ ",s.user]})]})]},s.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(F,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Aucune activit√© r√©cente"})]})})]})})]}),f&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[e.jsx(oe,{className:"w-6 h-6 mr-2 text-primary"}),"Intelligence Artificielle"]}),e.jsxs(a,{variant:"outline",size:"sm",onClick:()=>window.location.href="/analytics",children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Dashboard IA complet"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(ae,{type:"global",timeframe:{start:new Date(Date.now()-7*24*60*60*1e3).toISOString(),end:new Date().toISOString()},maxInsights:2,showTrends:!0,showRecommendations:!1,compact:!1}),e.jsx(ie,{type:"attendance",timeframe:{start:new Date(Date.now()-24*60*60*1e3).toISOString(),end:new Date().toISOString()},threshold:.7,autoRefresh:!0,refreshInterval:15,compact:!1})]}),e.jsx(re,{type:"global",targetId:"system",maxRecommendations:3,showPriority:!0,showActions:!0})]}),(p||C||f)&&e.jsxs(d,{children:[e.jsx(y,{children:e.jsx(A,{children:"Actions rapides"})}),e.jsx(m,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[p&&e.jsxs(a,{variant:"outline",className:"h-20 flex-col",children:[e.jsx(b,{className:"w-6 h-6 mb-2"}),"Cr√©er un √©v√©nement"]}),f&&e.jsxs(a,{variant:"outline",className:"h-20 flex-col",onClick:()=>window.location.href="/reports",children:[e.jsx(ee,{className:"w-6 h-6 mb-2"}),"G√©n√©rer un rapport"]}),f&&e.jsxs(a,{variant:"outline",className:"h-20 flex-col",onClick:()=>window.location.href="/predictions",children:[e.jsx(ue,{className:"w-6 h-6 mb-2"}),"Pr√©dictions IA"]}),C&&e.jsxs(a,{variant:"outline",className:"h-20 flex-col",children:[e.jsx(V,{className:"w-6 h-6 mb-2"}),"G√©rer les utilisateurs"]})]})})]})]})};export{_e as default};
//# sourceMappingURL=Dashboard-DelBZfXi.js.map
