import{w as J,z as Y,j as e,a as N,D as _,U as ee,o as se,E as U,X as z,y as L}from"./index-gm4XY7Dh.js";import{d as ae,r as x}from"./vendor-CvUQ7FSA.js";import{C as m,b as p,c as u,a as h}from"./Card-ct0JxCCf.js";import{I as c}from"./Input-BoijLIkg.js";import{L as n}from"./label-B3NocW4B.js";import{T as te}from"./textarea-DCMMGiR1.js";import{S as M,a as $,b as G,c as Q,d}from"./select-byvKiojp.js";import{C as j}from"./checkbox-T3_sBEbb.js";import{A as ie,a as re}from"./alert-dbwOQxjT.js";import{u as ne}from"./userService-LLdjq6tZ.js";import{e as le}from"./eventService-DkagHfbT.js";import{C as ce}from"./circle-alert-B-efKsjX.js";import{A as de}from"./arrow-left-yMfWrytx.js";import{M as oe}from"./map-pin-Dg8dt4LF.js";import{S as me}from"./save-BsTaTsK9.js";import"./firebase-De9GV7Vy.js";import"./index-TMJn6bF9.js";import"./chevron-down-L5bpcUyJ.js";import"./check-Cx9i6ejF.js";const Fe=()=>{const y=ae(),{user:b}=J(),{canCreateEvents:k}=Y(),[a,v]=x.useState({title:"",description:"",type:"meeting",startDate:"",endDate:"",location:{type:"physical",name:"",address:"",virtualLink:""},maxParticipants:void 0,isPrivate:!1,requiresApproval:!1,allowLateRegistration:!0,tags:[],participants:[],settings:{allowQRCode:!0,allowGeolocation:!0,allowManualCheckIn:!0,checkInWindow:30,sendReminders:!0,reminderTimes:[24,1]}}),[P,R]=x.useState(!1),[l,S]=x.useState({}),[A,V]=x.useState([]),[he,F]=x.useState(!1),[f,W]=x.useState(""),[C,T]=x.useState("");x.useEffect(()=>{if(!k){y("/events");return}H()},[k]);const H=async()=>{try{F(!0);const s=await ne.getUsers({limit:100});s.success&&s.data&&V(s.data.data)}catch(s){console.error("Error loading users:",s)}finally{F(!1)}},O=()=>{var t;const s={};return a.title.trim()||(s.title="Le titre est requis"),a.startDate||(s.startDate="La date de début est requise"),a.endDate||(s.endDate="La date de fin est requise"),a.startDate&&a.endDate&&new Date(a.startDate)>=new Date(a.endDate)&&(s.endDate="La date de fin doit être après la date de début"),a.location.name.trim()||(s.locationName="Le nom du lieu est requis"),a.location.type==="virtual"&&!((t=a.location.virtualLink)!=null&&t.trim())&&(s.virtualLink="Le lien virtuel est requis pour un événement virtuel"),a.maxParticipants&&a.maxParticipants<1&&(s.maxParticipants="Le nombre maximum de participants doit être supérieur à 0"),S(s),Object.keys(s).length===0},B=async s=>{if(s.preventDefault(),!O()){L.error("Veuillez corriger les erreurs dans le formulaire");return}R(!0);try{const t={title:a.title,description:a.description,type:a.type,startDate:a.startDate,endDate:a.endDate,location:a.location,maxParticipants:a.maxParticipants,isPrivate:a.isPrivate,requiresApproval:a.requiresApproval,allowLateRegistration:a.allowLateRegistration,tags:a.tags,participants:a.participants,settings:a.settings,organizerId:(b==null?void 0:b.id)||""},i=await le.createEvent(t);i.success&&i.data&&(L.success("Événement créé avec succès !"),y(`/events/${i.data.id}`))}catch(t){console.error("Error creating event:",t),L.error(t.message||"Erreur lors de la création de l'événement")}finally{R(!1)}},o=(s,t)=>{v(i=>({...i,[s]:t})),l[s]&&S(i=>({...i,[s]:""}))},w=(s,t)=>{v(i=>({...i,location:{...i.location,[s]:t}}))},g=(s,t)=>{v(i=>({...i,settings:{...i.settings,[s]:t}}))},I=()=>{C.trim()&&!a.tags.includes(C.trim())&&(v(s=>({...s,tags:[...s.tags,C.trim()]})),T(""))},K=s=>{v(t=>({...t,tags:t.tags.filter(i=>i!==s)}))},X=s=>{a.participants.includes(s)||v(t=>({...t,participants:[...t.participants,s]}))},Z=s=>{v(t=>({...t,participants:t.participants.filter(i=>i!==s)}))},q=A.filter(s=>{var t,i,E;return!a.participants.includes(s.id)&&(((t=s.displayName)==null?void 0:t.toLowerCase().includes(f.toLowerCase()))||((i=s.firstName)==null?void 0:i.toLowerCase().includes(f.toLowerCase()))||((E=s.lastName)==null?void 0:E.toLowerCase().includes(f.toLowerCase()))||s.email.toLowerCase().includes(f.toLowerCase()))}),D=A.filter(s=>a.participants.includes(s.id));if(!k)return e.jsx("div",{className:"container-fluid py-6",children:e.jsxs(ie,{variant:"destructive",children:[e.jsx(ce,{className:"h-4 w-4"}),e.jsx(re,{children:"Vous n'avez pas les permissions pour créer des événements."})]})});r,eturn(e.jsxs("div",{className:"container-fluid py-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(N,{variant:"outline",size:"sm",onClick:()=>y("/events"),children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),"Retour aux événements"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Créer un événement"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Organisez un nouvel événement et invitez des participants"})]})]})}),e.jsx("form",{onSubmit:B,className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(m,{children:[e.jsx(p,{children:e.jsx(u,{children:"Informations de base"})}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"title",children:"Titre de l'événement *"}),e.jsx(c,{id:"title",value:a.title,onChange:s=>o("title",s.target.value),placeholder:"Ex: Réunion équipe marketing",className:l.title?"border-red-500":""}),l.title&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.title})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"description",children:"Description"}),e.jsx(te,{id:"description",value:a.description,onChange:s=>o("description",s.target.value),placeholder:"Décrivez l'objectif et le contenu de l'événement...",rows:4})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"type",children:"Type d'événement"}),e.jsxs(M,{value:a.type,onValueChange:s=>o("type",s),children:[e.jsx($,{children:e.jsx(G,{})}),e.jsxs(Q,{children:[e.jsx(d,{value:"meeting",children:"Réunion"}),e.jsx(d,{value:"training",children:"Formation"}),e.jsx(d,{value:"conference",children:"Conférence"}),e.jsx(d,{value:"workshop",children:"Atelier"}),e.jsx(d,{value:"seminar",children:"Séminaire"}),e.jsx(d,{value:"webinar",children:"Webinaire"}),e.jsx(d,{value:"other",children:"Autre"})]})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"maxParticipants",children:"Nombre max de participants"}),e.jsx(c,{id:"maxParticipants",type:"number",min:"1",value:a.maxParticipants||"",onChange:s=>o("maxParticipants",s.target.value?parseInt(s.target.value):void 0),placeholder:"Illimité",className:l.maxParticipants?"border-red-500":""}),l.maxParticipants&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.maxParticipants})]})]})]})]}),e.jsxs(m,{children:[e.jsx(p,{children:e.jsxs(u,{className:"flex items-center",children:[e.jsx(_,{className:"w-5 h-5 mr-2"}),"Date et heure"]})}),e.jsx(h,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"startDate",children:"Date et heure de début *"}),e.jsx(c,{id:"startDate",type:"datetime-local",value:a.startDate,onChange:s=>o("startDate",s.target.value),className:l.startDate?"border-red-500":""}),l.startDate&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.startDate})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"endDate",children:"Date et heure de fin *"}),e.jsx(c,{id:"endDate",type:"datetime-local",value:a.endDate,onChange:s=>o("endDate",s.target.value),className:l.endDate?"border-red-500":""}),l.endDate&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.endDate})]})]})})]}),e.jsxs(m,{children:[e.jsx(p,{children:e.jsxs(u,{className:"flex items-center",children:[e.jsx(oe,{className:"w-5 h-5 mr-2"}),"Lieu"]})}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{children:"Type de lieu"}),e.jsxs(M,{value:a.location.type,onValueChange:s=>w("type",s),children:[e.jsx($,{children:e.jsx(G,{})}),e.jsxs(Q,{children:[e.jsx(d,{value:"physical",children:"Physique"}),e.jsx(d,{value:"virtual",children:"Virtuel"}),e.jsx(d,{value:"hybrid",children:"Hybride"})]})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"locationName",children:"Nom du lieu *"}),e.jsx(c,{id:"locationName",value:a.location.name,onChange:s=>w("name",s.target.value),placeholder:"Ex: Salle de conférence A, Zoom, Teams...",className:l.locationName?"border-red-500":""}),l.locationName&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.locationName})]}),(a.location.type==="physical"||a.location.type==="hybrid")&&e.jsxs("div",{children:[e.jsx(n,{htmlFor:"address",children:"Adresse"}),e.jsx(c,{id:"address",value:a.location.address||"",onChange:s=>w("address",s.target.value),placeholder:"123 Rue de la Paix, 75001 Paris"})]}),(a.location.type==="virtual"||a.location.type==="hybrid")&&e.jsxs("div",{children:[e.jsxs(n,{htmlFor:"virtualLink",children:["Lien virtuel ",a.location.type==="virtual"?"*":""]}),e.jsx(c,{id:"virtualLink",value:a.location.virtualLink||"",onChange:s=>w("virtualLink",s.target.value),placeholder:"https://zoom.us/j/123456789",className:l.virtualLink?"border-red-500":""}),l.virtualLink&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.virtualLink})]})]})]}),e.jsxs(m,{children:[e.jsx(p,{children:e.jsxs(u,{className:"flex items-center",children:[e.jsx(ee,{className:"w-5 h-5 mr-2"}),"Participants"]})}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{children:"Rechercher et ajouter des participants"}),e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(c,{placeholder:"Rechercher par nom ou email...",value:f,onChange:s=>W(s.target.value),className:"pl-10"})]})]}),f&&e.jsxs("div",{className:"border rounded-lg p-4 max-h-48 overflow-y-auto",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Utilisateurs disponibles"}),q.length>0?e.jsx("div",{className:"space-y-2",children:q.slice(0,10).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-muted rounded",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.displayName||`${s.firstName} ${s.lastName}`}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.email})]}),e.jsx(N,{type:"button",size:"sm",variant:"outline",onClick:()=>X(s.id),children:e.jsx(U,{className:"w-4 h-4"})})]},s.id))}):e.jsx("p",{className:"text-muted-foreground",children:"Aucun utilisateur trouvé"})]}),D.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium mb-2",children:["Participants sélectionnés (",D.length,")"]}),e.jsx("div",{className:"space-y-2",children:D.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-muted rounded",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.displayName||`${s.firstName} ${s.lastName}`}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.email})]}),e.jsx(N,{type:"button",size:"sm",variant:"outline",onClick:()=>Z(s.id),children:e.jsx(z,{className:"w-4 h-4"})})]},s.id))})]})]})]}),e.jsxs(m,{children:[e.jsx(p,{children:e.jsx(u,{children:"Tags"})}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(c,{placeholder:"Ajouter un tag...",value:C,onChange:s=>T(s.target.value),onKeyPress:s=>s.key==="Enter"&&(s.preventDefault(),I())}),e.jsx(N,{type:"button",onClick:I,variant:"outline",children:e.jsx(U,{className:"w-4 h-4"})})]}),a.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:a.tags.map(s=>e.jsxs("div",{className:"flex items-center bg-secondary text-secondary-foreground px-2 py-1 rounded-md text-sm",children:[s,e.jsx("button",{type:"button",onClick:()=>K(s),className:"ml-2 hover:text-destructive",children:e.jsx(z,{className:"w-3 h-3"})})]},s))})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(m,{children:[e.jsx(p,{children:e.jsx(u,{children:"Paramètres"})}),e.jsx(h,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{id:"isPrivate",checked:a.isPrivate,onCheckedChange:s=>o("isPrivate",s)}),e.jsx(n,{htmlFor:"isPrivate",children:"Événement privé"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{id:"requiresApproval",checked:a.requiresApproval,onCheckedChange:s=>o("requiresApproval",s)}),e.jsx(n,{htmlFor:"requiresApproval",children:"Approbation requise"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{id:"allowLateRegistration",checked:a.allowLateRegistration,onCheckedChange:s=>o("allowLateRegistration",s)}),e.jsx(n,{htmlFor:"allowLateRegistration",children:"Inscription tardive autorisée"})]})]})})]}),e.jsxs(m,{children:[e.jsx(p,{children:e.jsx(u,{children:"Paramètres de présence"})}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{id:"allowQRCode",checked:a.settings.allowQRCode,onCheckedChange:s=>g("allowQRCode",s)}),e.jsx(n,{htmlFor:"allowQRCode",children:"Code QR"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{id:"allowGeolocation",checked:a.settings.allowGeolocation,onCheckedChange:s=>g("allowGeolocation",s)}),e.jsx(n,{htmlFor:"allowGeolocation",children:"Géolocalisation"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{id:"allowManualCheckIn",checked:a.settings.allowManualCheckIn,onCheckedChange:s=>g("allowManualCheckIn",s)}),e.jsx(n,{htmlFor:"allowManualCheckIn",children:"Marquage manuel"})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"checkInWindow",children:"Fenêtre de marquage (minutes)"}),e.jsx(c,{id:"checkInWindow",type:"number",min:"0",value:a.settings.checkInWindow,onChange:s=>g("checkInWindow",parseInt(s.target.value))}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Temps avant/après l'événement pour marquer sa présence"})]})]})]}),e.jsxs(m,{children:[e.jsx(p,{children:e.jsx(u,{children:"Rappels"})}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{id:"sendReminders",checked:a.settings.sendReminders,onCheckedChange:s=>g("sendReminders",s)}),e.jsx(n,{htmlFor:"sendReminders",children:"Envoyer des rappels"})]}),a.settings.sendReminders&&e.jsxs("div",{children:[e.jsx(n,{children:"Heures avant l'événement"}),e.jsx("div",{className:"space-y-2",children:[24,12,6,1].map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{id:`reminder-${s}`,checked:a.settings.reminderTimes.includes(s),onCheckedChange:t=>{t?g("reminderTimes",[...a.settings.reminderTimes,s]):g("reminderTimes",a.settings.reminderTimes.filter(i=>i!==s))}}),e.jsxs(n,{htmlFor:`reminder-${s}`,children:[s,"h avant"]})]},s))})]})]})]}),e.jsx(m,{children:e.jsx(h,{className:"pt-6",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs(N,{type:"submit",className:"w-full",disabled:P,children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),P?"Création...":"Créer l'événement"]}),e.jsx(N,{type:"button",variant:"outline",className:"w-full",onClick:()=>y("/events"),children:"Annuler"})]})})})]})]})})]}))};export{Fe as default};
//# sourceMappingURL=CreateEvent-Bx4HxSNi.js.map
