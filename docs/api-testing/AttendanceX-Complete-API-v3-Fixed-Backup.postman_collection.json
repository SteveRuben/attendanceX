{
  "info": {
    "name": "AttendanceX Complete API v3.0 - Fixed & Flows",
    "description": "Collection complète avec bodies corrigés et flows automatisés pour tester l'API AttendanceX",
    "version": "3.0.1",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{accessToken}}",
        "type": "string"
      }
    ]
  },
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Auto-refresh token if expired",
          "const token = pm.environment.get('accessToken');",
          "if (token) {",
          "    try {",
          "        const payload = JSON.parse(atob(token.split('.')[1]));",
          "        const now = Math.floor(Date.now() / 1000);",
          "        if (payload.exp < now + 60) {",
          "            console.log('Token expires soon, consider refreshing...');",
          "        }",
          "    } catch (e) {",
          "        console.log('Invalid token format');",
          "    }",
          "}",
          "",
          "// Add tenant context header if available",
          "const tenantId = pm.environment.get('tenantId');",
          "if (tenantId) {",
          "    pm.request.headers.add({",
          "        key: 'X-Tenant-ID',",
          "        value: tenantId",
          "    });",
          "}"
        ]
      }
    }
  ],
  "variable": [
    {
      "key": "baseUrl",
      "value": "{{baseUrl}}",
      "type": "string"
    }
  ],
  "item": []
}